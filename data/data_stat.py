import os
import csv
import json
import datasets
import argparse

# huggingface dataset signature with configs
SERIES_A_DATASET_NAME_DICT = {
	"udhr": None,
	"AmazonScience/mintaka": None,
	"xcsr": [
		'X-CSQA-en', 
		'X-CSQA-zh', 
		'X-CSQA-de', 
		'X-CSQA-es', 
		'X-CSQA-fr', 
		'X-CSQA-it', 
		'X-CSQA-jap', 
		'X-CSQA-nl', 
		'X-CSQA-pl', 
		'X-CSQA-pt', 
		'X-CSQA-ru', 
		'X-CSQA-ar', 
		'X-CSQA-vi', 
		'X-CSQA-hi', 
		'X-CSQA-sw', 
		'X-CSQA-ur', 
		'X-CODAH-en', 
		'X-CODAH-zh', 
		'X-CODAH-de', 
		'X-CODAH-es', 
		'X-CODAH-fr', 
		'X-CODAH-it', 
		'X-CODAH-jap', 
		'X-CODAH-nl', 
		'X-CODAH-pl', 
		'X-CODAH-pt', 
		'X-CODAH-ru', 
		'X-CODAH-ar', 
		'X-CODAH-vi', 
		'X-CODAH-hi', 
		'X-CODAH-sw', 
		'X-CODAH-ur'
	],
	"shmuhammad/AfriSenti-twitter-sentiment": [
		'amh', 
		'hau', 
		'ibo',
		'arq', 
		'ary', 
		'yor', 
		'por', 
		'twi', 
		'tso', 
		'tir', 
		'pcm', 
		'kin', 
		'swa'
	], # orm is not workin
	"indonlp/NusaX-senti": [
		'ace', 
		'ban', 
		'bjn', 
		'bug',
		'eng',
		'ind',
		'jav', 
		'mad', 
		'min', 
		'nij', 
		'sun', 
		'bbc'
	],
	"masakhane/masakhanews": [
		'amh', 
		'eng', 
		'fra', 
		'hau', 
		'ibo', 
		'lin', 
		'lug', 
		'orm', 
		'pcm', 
		'run', 
		'sna', 
		'som', 
		'swa', 
		'tir', 
		'xho', 
		'yor'
	],
	"papluca/language-identification": [
		'wikipedia-zero-shot', 
		'wikipedia-zero-shot.af', 
		'wikipedia-zero-shot.ar', 
		'wikipedia-zero-shot.be', 
		'wikipedia-zero-shot.bg', 
		'wikipedia-zero-shot.bn',
		'wikipedia-zero-shot.ca',
		'wikipedia-zero-shot.cs', 
		'wikipedia-zero-shot.da', 
		'wikipedia-zero-shot.de', 
		'wikipedia-zero-shot.el', 
		'wikipedia-zero-shot.en',
		'wikipedia-zero-shot.es',
		'wikipedia-zero-shot.fa', 
		'wikipedia-zero-shot.fi',
		'wikipedia-zero-shot.fr',
		'wikipedia-zero-shot.he',
		'wikipedia-zero-shot.hi',
		'wikipedia-zero-shot.hu',
		'wikipedia-zero-shot.id',
		'wikipedia-zero-shot.it',
		'wikipedia-zero-shot.ja',
		'wikipedia-zero-shot.ko',
		'wikipedia-zero-shot.ml',
		'wikipedia-zero-shot.mr',
		'wikipedia-zero-shot.ms',
		'wikipedia-zero-shot.nl',
		'wikipedia-zero-shot.no',
		'wikipedia-zero-shot.pl',
		'wikipedia-zero-shot.pt',
		'wikipedia-zero-shot.ro',
		'wikipedia-zero-shot.ru',
		'wikipedia-zero-shot.si',
		'wikipedia-zero-shot.sk',
  		'wikipedia-zero-shot.sl',
		'wikipedia-zero-shot.sr', 
		'wikipedia-zero-shot.sv', 
		'wikipedia-zero-shot.sw',
		'wikipedia-zero-shot.ta', 
		'wikipedia-zero-shot.te',
		'wikipedia-zero-shot.th',
		'wikipedia-zero-shot.tr',
		'wikipedia-zero-shot.uk',
		'wikipedia-zero-shot.vi',
		'wikipedia-zero-shot.zh',
		'wikinews-zero-shot',
		'wikinews-zero-shot.ar',
		'wikinews-zero-shot.cs',
		'wikinews-zero-shot.de',
		'wikinews-zero-shot.en',
		'wikinews-zero-shot.es',
		'wikinews-zero-shot.fi', 
		'wikinews-zero-shot.fr',
		'wikinews-zero-shot.it',
		'wikinews-zero-shot.ja',
		'wikinews-zero-shot.ko',
		'wikinews-zero-shot.nl',
		'wikinews-zero-shot.no',
		'wikinews-zero-shot.pl',
		'wikinews-zero-shot.pt',
		'wikinews-zero-shot.ru',
		'wikinews-zero-shot.sr',
		'wikinews-zero-shot.sv',
		'wikinews-zero-shot.ta',
		'wikinews-zero-shot.tr',
		'wikinews-zero-shot.uk',
		'wikinews-zero-shot.zh',
		'wikinews-cross-domain', 
		'wikinews-cross-domain.ar',
		'wikinews-cross-domain.bg',
		'wikinews-cross-domain.ca',
		'wikinews-cross-domain.cs',
		'wikinews-cross-domain.de',
		'wikinews-cross-domain.el',
		'wikinews-cross-domain.en',
		'wikinews-cross-domain.es',
		'wikinews-cross-domain.fi',
		'wikinews-cross-domain.fr',
		'wikinews-cross-domain.he', 
		'wikinews-cross-domain.hu', 
		'wikinews-cross-domain.it', 
		'wikinews-cross-domain.ja',
  		'wikinews-cross-domain.ko',
		'wikinews-cross-domain.nl',
		'wikinews-cross-domain.no',
  		'wikinews-cross-domain.pl',
		'wikinews-cross-domain.pt',
		'wikinews-cross-domain.ro',
  		'wikinews-cross-domain.ru',
		'wikinews-cross-domain.sr',
		'wikinews-cross-domain.sv',
		'wikinews-cross-domain.ta',
	 	'wikinews-cross-domain.tr',
	  	'wikinews-cross-domain.uk', 
		'wikinews-cross-domain.zh'
	],
	"adithya7/xlel_wd": [
		'wikipedia-zero-shot', 
		'wikipedia-zero-shot.af', 
		'wikipedia-zero-shot.ar', 
		'wikipedia-zero-shot.be', 
		'wikipedia-zero-shot.bg',
		'wikipedia-zero-shot.bn',
		'wikipedia-zero-shot.ca',
		'wikipedia-zero-shot.cs',
		'wikipedia-zero-shot.da',
		'wikipedia-zero-shot.de',
		'wikipedia-zero-shot.el',
		'wikipedia-zero-shot.en',
		'wikipedia-zero-shot.es',
		'wikipedia-zero-shot.fa',
		'wikipedia-zero-shot.fi',
		'wikipedia-zero-shot.fr',
		'wikipedia-zero-shot.he',
		'wikipedia-zero-shot.hi',
		'wikipedia-zero-shot.hu', 
		'wikipedia-zero-shot.id',
		'wikipedia-zero-shot.it',
		'wikipedia-zero-shot.ja',
		'wikipedia-zero-shot.ko',
		'wikipedia-zero-shot.ml',
		'wikipedia-zero-shot.mr',
		'wikipedia-zero-shot.ms',
		'wikipedia-zero-shot.nl',
		'wikipedia-zero-shot.no', 
		'wikipedia-zero-shot.pl',
		'wikipedia-zero-shot.pt',
		'wikipedia-zero-shot.ro',
		'wikipedia-zero-shot.ru',
		'wikipedia-zero-shot.si',
		'wikipedia-zero-shot.sk',
		'wikipedia-zero-shot.sl',
		'wikipedia-zero-shot.sr',
		'wikipedia-zero-shot.sv',
		'wikipedia-zero-shot.sw',
		'wikipedia-zero-shot.ta',
		'wikipedia-zero-shot.te',
		'wikipedia-zero-shot.th', 
		'wikipedia-zero-shot.tr',
		'wikipedia-zero-shot.uk',
	 	'wikipedia-zero-shot.vi', 
		'wikipedia-zero-shot.zh',
	 	'wikinews-zero-shot',
	  	'wikinews-zero-shot.ar',
	   	'wikinews-zero-shot.cs',
		'wikinews-zero-shot.de',
		'wikinews-zero-shot.en',
		'wikinews-zero-shot.es',
		'wikinews-zero-shot.fi',
		'wikinews-zero-shot.fr',
		'wikinews-zero-shot.it',
		'wikinews-zero-shot.ja',
		'wikinews-zero-shot.ko',
		'wikinews-zero-shot.nl', 
		'wikinews-zero-shot.no', 
		'wikinews-zero-shot.pl',
	 	'wikinews-zero-shot.pt', 
		'wikinews-zero-shot.ru', 
		'wikinews-zero-shot.sr',
		'wikinews-zero-shot.sv', 
		'wikinews-zero-shot.ta',
	 	'wikinews-zero-shot.tr',
	  	'wikinews-zero-shot.uk',
		'wikinews-zero-shot.zh',
		'wikinews-cross-domain',
		'wikinews-cross-domain.ar',
		'wikinews-cross-domain.bg',
		'wikinews-cross-domain.ca',
		'wikinews-cross-domain.cs',
	 	'wikinews-cross-domain.de',
		'wikinews-cross-domain.el',
	 	'wikinews-cross-domain.en',
	  	'wikinews-cross-domain.es',
	   	'wikinews-cross-domain.fi',
		'wikinews-cross-domain.fr', 
		'wikinews-cross-domain.he', 
		'wikinews-cross-domain.hu', 
		'wikinews-cross-domain.it', 
		'wikinews-cross-domain.ja', 
		'wikinews-cross-domain.ko', 
		'wikinews-cross-domain.nl', 
		'wikinews-cross-domain.no', 
		'wikinews-cross-domain.pl', 
		'wikinews-cross-domain.pt', 
		'wikinews-cross-domain.ro', 
		'wikinews-cross-domain.ru', 
		'wikinews-cross-domain.sr', 
		'wikinews-cross-domain.sv', 
		'wikinews-cross-domain.ta', 
		'wikinews-cross-domain.tr', 
		'wikinews-cross-domain.uk', 
		'wikinews-cross-domain.zh'
	],
	"sbmaruf/forai_ml-ted_talk_iwslt": [
		'eu_ca_2014', 
	 	'eu_ca_2015', 
	  	'eu_ca_2016', 
	   	'nl_en_2014', 
		'nl_en_2015', 
		'nl_en_2016', 
		'nl_hi_2014', 
		'nl_hi_2015', 
		'nl_hi_2016', 
		'de_ja_2014', 
		'de_ja_2015', 
		'de_ja_2016', 
		'fr-ca_hi_2014', 
		'fr-ca_hi_2015', 
		'fr-ca_hi_2016'
	],
	"sbmaruf/forai_ml_masakhane_mafand":[
		'en-amh', 
		'en-hau', 
		'en-ibo', 
		'en-kin', 
		'en-lug', 
		'en-nya', 
		'en-pcm', 
		'en-sna', 
		'en-swa', 
		'en-tsn', 
		'en-twi', 
		'en-xho', 
		'en-yor', 
		'en-zul', 
		'fr-bam', 
		'fr-bbj', 
		'fr-ewe', 
		'fr-fon', 
		'fr-mos', 
		'fr-wol'
	],
	"exams":[
		'alignments', 
		'multilingual', 
		'multilingual_with_para', 
		'crosslingual_test', 
		'crosslingual_with_para_test', 
		'crosslingual_bg', 
		'crosslingual_with_para_bg', 
		'crosslingual_hr', 
		'crosslingual_with_para_hr', 
		'crosslingual_hu', 
		'crosslingual_with_para_hu', 
		'crosslingual_it', 
		'crosslingual_with_para_it', 
		'crosslingual_mk', 
		'crosslingual_with_para_mk', 
		'crosslingual_pl', 
		'crosslingual_with_para_pl', 
		'crosslingual_pt', 
		'crosslingual_with_para_pt', 
		'crosslingual_sq', 
		'crosslingual_with_para_sq', 
		'crosslingual_sr', 
		'crosslingual_with_para_sr', 
		'crosslingual_tr', 
		'crosslingual_with_para_tr', 
		'crosslingual_vi', 
		'crosslingual_with_para_vi'
	],
	"allenai/soda": None, 
	"arabic_billion_words":[
		'Alittihad', 
		'Almasryalyoum', 
		'Almustaqbal', 
		'Alqabas', 
		'Echoroukonline', 
		'Ryiadh', 
		'Sabanews', 
		'SaudiYoum', 
		'Techreen', 
		'Youm7'
	]
}

def main():
	parser = argparse.ArgumentParser()
	parser.add_argument(
		"--dataset-names",
		nargs="+",
		default=None,
		help="Print the stat of the dataset. If `None` it will print stat of all the used data."
	)
	parser.add_argument(
		"--export-format",
		choices=['json', "csv"],
		default=".json",
		help="Which format you want to export."
	)
	parser.add_argument(
		"--output-dir",
		default=None,
		help="The path to the folder where stat will be saved."
	)
	args = parser.parse_args()
	stat_dict = {}
	if args.dataset_names is None:
		args.dataset_names = list(SERIES_A_DATASET_NAME_DICT.keys())
	for dataset_name, subset_names in SERIES_A_DATASET_NAME_DICT.items():
		if dataset_name not in args.dataset_names:
			continue
		assert dataset_name not in stat_dict
		stat_dict[dataset_name] = {}
		subset_names = [None] if subset_names is None else subset_names
		for subset in subset_names:
			assert subset not in stat_dict[dataset_name]
			stat_dict[dataset_name][subset] = {}
			dt = datasets.load_dataset(dataset_name, name=subset, ignore_verifications=True)
			for split in dt.keys():
				stat_dict[dataset_name][subset][split] = {
					"size": len(dt[split]),
					"column": list(dt[split].column_names),
				}
				# re-valuation of hypothesis considered in prompt template
				if subset is not None and "X-CSQA" in subset:
					for sample in dt[split]:
						assert len(sample['question']['choices']['label']) == 5

	if args.output_dir != 'None': 
		file_name = os.path.join(args.output_dir, "stat") + f".{args.export_format}"
		if args.export_format == "json":
			with open(file_name, "w") as file_ptr:
				file_ptr.write(f"{json.dumps(stat_dict, indent=4)}\n")
		elif args.export_format == "csv":
			# with open(file_name, mode='w') as file_ptr:
			# 	writer = csv.writer(file_ptr)
			# 	for dataset_name, subset_name, in SERIES_A_DATASET_NAME_DICT.keys():
			# 		row = [f"{dataset_name}"]
				
			# 	writer.writerow(stat_dict.values())
			pass
		else:
			raise NotImplementedError

if __name__ == "__main__":
	main()
   
